(this["webpackJsonpreact-patterns"]=this["webpackJsonpreact-patterns"]||[]).push([[0],{31:function(e,t,n){e.exports=n(43)},42:function(e,t,n){},43:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n(0),r=n.n(o),c=n(26),l=n.n(c),s=n(27),i=n.n(s),p=n(28),m=n.n(p),u=n(11),b=n(14),d=n(3),h={},j="wrapper";function O(e){var t=e.components,n=Object(d.a)(e,["components"]);return Object(a.b)(j,Object.assign({},h,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",null,"Overview"),Object(a.b)("p",null,"The project is created to experiment with different approaches to use\nReact and create a list of do's, dont's, problematic approaches and best\npractice in terms of performance, readability, extensibility and\nmaintainability."))}O.isMDXComponent=!0;var f=n(13),g=n(4),v=n(5),C=n(7),E=n(6),y=n(8),N=function(){var e=r.a.useState(),t=Object(f.a)(e,2)[1];return function(){return t({})}},x=n(17),w=r.a.memo((function(e){var t=r.a.useRef(0);return t.current+=1,r.a.createElement("div",{style:Object(x.a)({},e.style,{borderStyle:"solid",borderWidth:3,borderColor:e.color,position:"relative",width:"70%",marginTop:4,marginBottom:4})},r.a.createElement("div",{style:{position:"absolute",right:0,top:0,background:"black",color:"white",fontFamily:"monospace",padding:2}},"Render count: ",t.current),e.children)})),k=function(e){function t(){return Object(g.a)(this,t),Object(C.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement(w,{color:"red"},"Child Class Component: ",this.props.value)}}]),t}(o.Component),S=function(e){function t(){return Object(g.a)(this,t),Object(C.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(v.a)(t,[{key:"shouldComponentUpdate",value:function(e){return e.value!==this.props.value}},{key:"render",value:function(){return r.a.createElement(w,{color:"red"},"Child Class Component ",r.a.createElement("strong",null,"Memoized"),": ",this.props.value)}}]),t}(o.Component),R=function(e){function t(){return Object(g.a)(this,t),Object(C.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement(w,{color:"green"},"Child Pure Component: ",this.props.value)}}]),t}(o.PureComponent),P=function(e){function t(){return Object(g.a)(this,t),Object(C.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement(w,{color:"green"},"Child Pure Component ",r.a.createElement("strong",null,"Memoized"),": ",this.props.value)}}]),t}(o.PureComponent),T=function(e){return r.a.createElement(w,{color:"blue"},"Child Function Component: ",e.value)},M=r.a.memo((function(e){return r.a.createElement(w,{color:"blue"},"Child Function Component ",r.a.createElement("strong",null,"Memoized"),": ",e.value)})),F=function(e){function t(){return Object(g.a)(this,t),Object(C.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement(w,{color:"black"},r.a.createElement("p",null,"Container"),r.a.createElement(k,{value:this.props.value}),r.a.createElement(R,{value:this.props.value}),r.a.createElement(T,{value:this.props.value}))}}]),t}(o.Component),D=function(e){function t(){return Object(g.a)(this,t),Object(C.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement(w,{color:"black"},r.a.createElement("p",null,"Container"),r.a.createElement(S,{value:this.props.value}),r.a.createElement(P,{value:this.props.value}),r.a.createElement(M,{value:this.props.value}))}}]),t}(o.Component),z=function(e){var t=function(e){var t=r.a.useState(1),n=Object(f.a)(t,2),a=n[0],o=n[1];return[function(){return o(a+1)},e?a:1]}(e.changeProps),n=Object(f.a)(t,2),a=n[0],o=n[1];return r.a.createElement(r.a.Fragment,null,e.isMemoized?r.a.createElement(D,{value:o}):r.a.createElement(F,{value:o}),r.a.createElement("hr",{style:{background:"transparent"}}),r.a.createElement("button",{onClick:function(){return a()}},"Render example"))},I={},J="wrapper";function A(e){var t=e.components,n=Object(d.a)(e,["components"]);return Object(a.b)(J,Object.assign({},I,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",null,"Components"),Object(a.b)("p",null,Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://reactjs.org/docs/react-component.html"}),Object(a.b)("inlineCode",{parentName:"a"},"React.Component"))," encapsulates ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://reactjs.org/docs/state-and-lifecycle.html"}),"State and Lifecycle"),"."),Object(a.b)("p",null,"There are few types o the components available in React:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("strong",{parentName:"li"},"Class Components")," - the component which extends ",Object(a.b)("a",Object.assign({parentName:"li"},{href:"https://reactjs.org/docs/react-api.html#reactcomponent"}),Object(a.b)("inlineCode",{parentName:"a"},"React.Component"))," and uses OOP paradigms to handle state, properties, actions and manage component lifecycle. React component re-renders if the parent component got re-rendered even if no props were changed."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("strong",{parentName:"li"},"Pure Components")," - the ",Object(a.b)("a",Object.assign({parentName:"li"},{href:"https://reactjs.org/docs/react-api.html#reactpurecomponent"}),Object(a.b)("inlineCode",{parentName:"a"},"React.PureComponent"))," is similar to the ",Object(a.b)("inlineCode",{parentName:"li"},"React.Component"),". The difference between them is that ",Object(a.b)("inlineCode",{parentName:"li"},"React.Component")," doesn\u2019t implement ",Object(a.b)("inlineCode",{parentName:"li"},"shouldComponentUpdate()"),", but ",Object(a.b)("inlineCode",{parentName:"li"},"React.PureComponent")," implements it with a ",Object(a.b)("strong",{parentName:"li"},"shallow prop and state comparison"),"."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("strong",{parentName:"li"},"Function Component")," - the ",Object(a.b)("inlineCode",{parentName:"li"},"React.FunctionComponent")," is the component which takes props and renders them based on internal component logic.")),Object(a.b)("h3",null,"Regular components no props change"),Object(a.b)("p",null,"If there is no any additional work on the child components done the ",Object(a.b)("inlineCode",{parentName:"p"},"Class")," and ",Object(a.b)("inlineCode",{parentName:"p"},"Function")," children components will re-render even if ",Object(a.b)("strong",{parentName:"p"},"no properties have been changed"),"."),Object(a.b)("p",null,"As ",Object(a.b)("inlineCode",{parentName:"p"},"Pure")," component implements shallow comparison of the props out of the box, it won't re-render."),Object(a.b)(z,{isMemoized:!1,changeProps:!1,mdxType:"AllComponents"}),Object(a.b)("h3",null,"Regular components props change"),Object(a.b)("p",null,"If ",Object(a.b)("strong",{parentName:"p"},"any prop has been changed")," on any of the component type: ",Object(a.b)("inlineCode",{parentName:"p"},"Class"),", ",Object(a.b)("inlineCode",{parentName:"p"},"Pure"),", ",Object(a.b)("inlineCode",{parentName:"p"},"Function")," all of them will re-render and this is ",Object(a.b)("strong",{parentName:"p"},"expected")," behavior."),Object(a.b)(z,{isMemoized:!1,changeProps:!0,mdxType:"AllComponents"}),Object(a.b)("h3",null,"Memoized components no props change"),Object(a.b)("p",null,'Components should be "memoized" to prevent re-rendering when no props have been changed.'),Object(a.b)("p",null,'The "memoziation" techniques described in the corresponding section of each component type.'),Object(a.b)("p",null,"The only ",Object(a.b)("inlineCode",{parentName:"p"},"Pure")," component has this functionality out of the box and no additional work for such component required."),Object(a.b)(z,{isMemoized:!0,changeProps:!1,mdxType:"AllComponents"}),Object(a.b)("h3",null,"Memoized components props change"),Object(a.b)("p",null,"If ",Object(a.b)("strong",{parentName:"p"},"any prop has been changed")," on any of the component type: ",Object(a.b)("inlineCode",{parentName:"p"},"Class"),", ",Object(a.b)("inlineCode",{parentName:"p"},"Pure"),", ",Object(a.b)("inlineCode",{parentName:"p"},"Function"),' all of them will re-render even if they are "memoized" and this is ',Object(a.b)("strong",{parentName:"p"},"expected")," behavior."),Object(a.b)(z,{isMemoized:!0,changeProps:!0,mdxType:"AllComponents"}))}A.isMDXComponent=!0;var X=function(e){function t(){return Object(g.a)(this,t),Object(C.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement(w,{color:"black"},r.a.createElement("p",null,"Container"),r.a.createElement(k,{value:1}))}}]),t}(o.Component),L=function(e){function t(){return Object(g.a)(this,t),Object(C.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement(w,{color:"black"},r.a.createElement("p",null,"Container"),r.a.createElement(S,{value:1}))}}]),t}(o.Component),B=function(e){var t=N();return r.a.createElement(r.a.Fragment,null,e.isMemoized?r.a.createElement(L,null):r.a.createElement(X,null),r.a.createElement("hr",{style:{background:"transparent"}}),r.a.createElement("button",{onClick:t},"Render example"))},U={},V="wrapper";function W(e){var t=e.components,n=Object(d.a)(e,["components"]);return Object(a.b)(V,Object.assign({},U,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",null,"Class Component"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"React.Component")," encapsulates ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://reactjs.org/docs/state-and-lifecycle.html"}),"State and Lifecycle"),"."),Object(a.b)("h3",null,"Normal"),Object(a.b)(B,{isMemoized:!1,mdxType:"ClassComponent"}),Object(a.b)("h3",null,"Memoized"),Object(a.b)(B,{isMemoized:!0,mdxType:"ClassComponent"}))}W.isMDXComponent=!0;var $=function(e){function t(){return Object(g.a)(this,t),Object(C.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement(w,{color:"black"},r.a.createElement("p",null,"Container"),r.a.createElement(R,{value:1}))}}]),t}(o.Component),_=function(e){function t(){return Object(g.a)(this,t),Object(C.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement(w,{color:"black"},r.a.createElement("p",null,"Container"),r.a.createElement(P,{value:1}))}}]),t}(o.Component),q=function(e){var t=N();return r.a.createElement(r.a.Fragment,null,e.isMemoized?r.a.createElement(_,null):r.a.createElement($,null),r.a.createElement("hr",{style:{background:"transparent"}}),r.a.createElement("button",{onClick:t},"Render example"))},H={},K="wrapper";function G(e){var t=e.components,n=Object(d.a)(e,["components"]);return Object(a.b)(K,Object.assign({},H,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",null,"Pure Component"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"React.Component")," encapsulates ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://reactjs.org/docs/state-and-lifecycle.html"}),"State and Lifecycle"),"."),Object(a.b)("h3",null,"Normal"),Object(a.b)(q,{isMemoized:!1,mdxType:"PureComponent"}),Object(a.b)("h3",null,"Memoized"),Object(a.b)(q,{isMemoized:!0,mdxType:"PureComponent"}))}G.isMDXComponent=!0;var Q=function(e){function t(){return Object(g.a)(this,t),Object(C.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement(w,{color:"black"},r.a.createElement("p",null,"Container"),r.a.createElement(T,{value:1}))}}]),t}(o.Component),Y=function(e){function t(){return Object(g.a)(this,t),Object(C.a)(this,Object(E.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){return r.a.createElement(w,{color:"black"},r.a.createElement("p",null,"Container"),r.a.createElement(M,{value:1}))}}]),t}(o.Component),Z=function(e){var t=N();return r.a.createElement(r.a.Fragment,null,e.isMemoized?r.a.createElement(Y,null):r.a.createElement(Q,null),r.a.createElement("hr",{style:{background:"transparent"}}),r.a.createElement("button",{onClick:t},"Render example"))},ee={},te="wrapper";function ne(e){var t=e.components,n=Object(d.a)(e,["components"]);return Object(a.b)(te,Object.assign({},ee,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",null,"Function Component"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"React.Component")," encapsulates ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://reactjs.org/docs/state-and-lifecycle.html"}),"State and Lifecycle"),"."),Object(a.b)("h3",null,"Normal"),Object(a.b)(Z,{isMemoized:!1,mdxType:"FunctionComponent"}),Object(a.b)("h3",null,"Memoized"),Object(a.b)(Z,{isMemoized:!0,mdxType:"FunctionComponent"}))}ne.isMDXComponent=!0;var ae={},oe="wrapper";function re(e){var t=e.components,n=Object(d.a)(e,["components"]);return Object(a.b)(oe,Object.assign({},ae,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",null,"Hooks"))}re.isMDXComponent=!0;var ce={},le="wrapper";function se(e){var t=e.components,n=Object(d.a)(e,["components"]);return Object(a.b)(le,Object.assign({},ce,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",null,"Functions"))}se.isMDXComponent=!0;var ie=r.a.createContext({value:1}),pe=function(e){var t=r.a.useMemo((function(){return{value:1}}),[]);return r.a.createElement(w,{color:"blue"},r.a.createElement(ie.Provider,{value:t},r.a.createElement("div",null,r.a.createElement("code",null,"Provider: ",JSON.stringify(t,null,2))),r.a.createElement("div",null,e.children)))},me=r.a.memo((function(){var e=r.a.useContext(ie);return r.a.createElement(w,{color:"green"},r.a.createElement("code",null,"Consumer: ",JSON.stringify(e,null,2)))})),ue=function(){var e=N();return r.a.createElement(r.a.Fragment,null,r.a.createElement(pe,null,r.a.createElement(me,null)),r.a.createElement("hr",{style:{background:"transparent"}}),r.a.createElement("button",{onClick:e},"Render example"))},be=r.a.createContext(0),de=r.a.createContext(0),he=function(e){var t=e.foo,n=e.bar;return r.a.createElement(w,{color:"blue"},r.a.createElement(be.Provider,{value:t},r.a.createElement(de.Provider,{value:n},r.a.createElement("div",null,r.a.createElement("code",null,"Provider: ",JSON.stringify({foo:t,bar:n},null,2))),r.a.createElement("div",null,e.children))))},je=r.a.memo((function(){var e=r.a.useContext(be);return r.a.createElement(w,{color:"green"},r.a.createElement("code",null,"ConsumerFoo: ",JSON.stringify(e,null,2)))})),Oe=r.a.memo((function(){var e=r.a.useContext(de);return r.a.createElement(w,{color:"red"},r.a.createElement("code",null,"ConsumerBar: ",JSON.stringify(e,null,2)))})),fe=function(){var e=r.a.useState(0),t=Object(f.a)(e,2),n=t[0],a=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(he,{foo:n,bar:1},r.a.createElement(je,null),r.a.createElement(Oe,null)),r.a.createElement("hr",{style:{background:"transparent"}}),r.a.createElement("button",{onClick:function(){return a(n+1)}},"Render example"))},ge=n(18),ve=Object(ge.createContext)({foo:0,bar:0}),Ce=function(e){var t=e.foo,n=e.bar;return r.a.createElement(w,{color:"blue"},r.a.createElement(ve.Provider,{value:{foo:t,bar:n}},r.a.createElement("div",null,r.a.createElement("code",null,"Provider: ",JSON.stringify({foo:t,bar:n},null,2))),r.a.createElement("div",null,e.children)))},Ee=r.a.memo((function(){var e=Object(ge.useContextSelector)(ve,(function(e){return e.foo}));return r.a.createElement(w,{color:"green"},r.a.createElement("code",null,"ConsumerFoo: ",JSON.stringify(e,null,2)))})),ye=r.a.memo((function(){var e=Object(ge.useContextSelector)(ve,(function(e){return e.bar}));return r.a.createElement(w,{color:"red"},r.a.createElement("code",null,"ConsumerBar: ",JSON.stringify(e,null,2)))})),Ne=function(){var e=r.a.useState(0),t=Object(f.a)(e,2),n=t[0],a=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ce,{foo:n,bar:1},r.a.createElement(Ee,null),r.a.createElement(ye,null)),r.a.createElement("hr",{style:{background:"transparent"}}),r.a.createElement("button",{onClick:function(){return a(n+1)}},"Render example"))},xe=r.a.createContext({value:1}),we=function(e){var t={value:1};return r.a.createElement(w,{color:"blue"},r.a.createElement(xe.Provider,{value:t},r.a.createElement("div",null,r.a.createElement("code",null,"Provider: ",JSON.stringify(t,null,2))),r.a.createElement("div",null,e.children)))},ke=r.a.memo((function(){var e=r.a.useContext(xe);return r.a.createElement(w,{color:"green"},r.a.createElement("code",null,"Consumer: ",JSON.stringify(e,null,2)))})),Se=function(){var e=N();return r.a.createElement(r.a.Fragment,null,r.a.createElement(we,null,r.a.createElement(ke,null)),r.a.createElement("hr",{style:{background:"transparent"}}),r.a.createElement("button",{onClick:e},"Render example"))},Re={},Pe="wrapper";function Te(e){var t=e.components,n=Object(d.a)(e,["components"]);return Object(a.b)(Pe,Object.assign({},Re,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",null,"Context"),Object(a.b)("p",null,"This page covers only modern React Context API, i.e. ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://reactjs.org/docs/context.html"}),Object(a.b)("inlineCode",{parentName:"a"},"createContext()")),"."),Object(a.b)("h3",null,"Context behavior"),Object(a.b)("p",null,"All consumers that are descendants of a ",Object(a.b)("inlineCode",{parentName:"p"},"Provider")," will re-render whenever the ",Object(a.b)("inlineCode",{parentName:"p"},"Provider"),"\u2019s ",Object(a.b)("inlineCode",{parentName:"p"},"value")," prop changes. The propagation from ",Object(a.b)("inlineCode",{parentName:"p"},"Provider")," to its descendant consumers (including ",Object(a.b)("inlineCode",{parentName:"p"},".contextType")," on class components and ",Object(a.b)("inlineCode",{parentName:"p"},"useContext()")," hook) is not subject to the ",Object(a.b)("inlineCode",{parentName:"p"},"shouldComponentUpdate()")," method or ",Object(a.b)("inlineCode",{parentName:"p"},"React.memo()"),", so the consumer is updated even when an ancestor component skips an update."),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),"// \ud83d\udca1 React.memo will ignored\nconst Example = React.memo(props => {\n  // \ud83d\udca3 Updates will be triggered inside\n  const value = React.useContext(Context);\n\n  return <div />;\n});\n")),Object(a.b)("p",null,"For example the code below will trigger rerender always as ",Object(a.b)("inlineCode",{parentName:"p"},"context")," object will be always newly created."),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),"const Example = props => {\n  const { children } = props;\n  // \u26d4 ({ value: 1 } === { value: 1 }) is false, so reference is different\n  const context = { value: 1 };\n\n  return <Provider value={context}>{children}</Provider>;\n};\n")),Object(a.b)(Se,{mdxType:"ContextUnmemoizedExample"}),Object(a.b)("h3",null,"Solution 1: Use memoized context value"),Object(a.b)("p",null,"If value is changing rarely is good option to memoize an object value with ",Object(a.b)("inlineCode",{parentName:"p"},"useMemo()")," hook."),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),"const Example = props => {\n  const { children, value } = props;\n  // \u2705 Now new `context` will be recreated only on `value` change\n  const context = React.useMemo(() => ({ value }), [value]);\n\n  return <Provider value={context}>{children}</Provider>;\n};\n")),Object(a.b)(ue,{mdxType:"ContextMemoized"}),Object(a.b)("p",null,"For class components you can use ",Object(a.b)("inlineCode",{parentName:"p"},"this.state"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),"class Example extends React.Component {\n  render() {\n    return <Provider value={this.state}>{children}</Provider>;\n  }\n}\n")),Object(a.b)("h3",null,"Solution 2: Use separate contexts"),Object(a.b)("p",null,"This trick was ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://kentcdodds.com/blog/how-to-use-react-context-effectively"}),"described")," by Kent Dodds. Idea is to pass plain/memoized\nvalues in separate contexts to avoid useless notifications to subscribers."),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),"const Example = props => {\n  const { children } = props;\n\n  // \u2757 both values are plain and safe for shallow compare\n  const firstValue = 1;\n  const secondValue = 2;\n\n  return (\n    <FirstProvider value={firstValue}>\n      <SecondProvider value={secondValue}>{children}</SecondProvider>\n    </FirstProvider>\n  );\n};\n")),Object(a.b)(fe,{mdxType:"ContextSeparate"}),Object(a.b)("h3",null,"Solution 3: Experimental bits API"),Object(a.b)("p",null,"React provides an expiremental API with ",Object(a.b)("inlineCode",{parentName:"p"},"calculateChangedBits")," & ",Object(a.b)("inlineCode",{parentName:"p"},"calculateChangedBits"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),"function createContext<T>(defaultValue: T, calculateChangedBits?: (prev: T, next: T) => number): Context<T>;\nfunction useContext<T>(context: Context<T>, observedBits?: number|boolean): T;\n")),Object(a.b)("p",null,"Which allows to change default behavior of Context API and avoid useless rerenders. As it's experimental there are no official docs yet, check ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://medium.com/@leonardobrunolima/react-tips-context-api-performance-considerations-d964f3ad3087"}),"this article")," to get more details."),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"changedBits === 0")," has a ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/facebook/react/blob/9b0bd43550206e04bfe9ca695e5981eff0e2d03f/packages/react-reconciler/src/ReactFiberBeginWork.js#L2304"}),"special handling")," in ",Object(a.b)("inlineCode",{parentName:"p"},"react-reconciler"),", so the simplest and interesting trick is to disable any consumer's updates:"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),"// \u2620\ufe0f Even is `value` will change updates will be silenced\nconst Context = React.createContext(value, () => 0);\n")),Object(a.b)("p",null,Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://www.npmjs.com/package/use-context-selector"}),Object(a.b)("inlineCode",{parentName:"a"},"use-context-selector"))," uses ",Object(a.b)("inlineCode",{parentName:"p"},"changedBits === 0")," to implement selector-like API for hooks which currently stays as an ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/reactjs/rfcs/pull/119"}),"open RFC"),"."),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),"const Example = React.memo(props => {\n  // \u2705 Updates of other context properties will be ignored\n  const locale = useContextSelector(LocaleContext, v => v.locale);\n\n  return <div>Current locale is {locale}.</div>;\n});\n")),Object(a.b)(Ne,{mdxType:"ContextSelectorExample"}),Object(a.b)("p",null,"There is also a lot of custom context/global state implementations, comparison\nfor Concurrent mode ",Object(a.b)("a",Object.assign({parentName:"p"},{href:"https://github.com/dai-shi/will-this-react-global-state-work-in-concurrent-mode"}),"available there"),"."))}Te.isMDXComponent=!0;var Me={},Fe="wrapper";function De(e){var t=e.components,n=Object(d.a)(e,["components"]);return Object(a.b)(Fe,Object.assign({},Me,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",null,"State Immutability in React, why it is important, and how to achieve it using Immer"),Object(a.b)("p",null,"React ",Object(a.b)("em",{parentName:"p"},"props")," and ",Object(a.b)("em",{parentName:"p"},"state")," are readonly by contract; it is, however, very easy to break this contract\nand introduce issues that are difficult to debug. In order to prevent these issues it is advised not\nto mutate state unless necessary. If non-trivial mutation of the current state is unvoidable, it is\nadvised to use an immutability helper called Immer."),Object(a.b)("p",null,"In the text below we start with a piece of code\nthat doesn't work, we transform it into code that works, but is error-prone and unreadable, and eventually\nwe reach the state of well readable and easily maintainable code. As we go over these phases\nwe gradually build a case for using Immer."),Object(a.b)("h3",null,"State mutation outside of setState mechanism"),Object(a.b)("p",null,"React ",Object(a.b)("em",{parentName:"p"},"state")," is declared readonly, but that only means that the ",Object(a.b)("em",{parentName:"p"},"reference")," to it is constant. This\neffectively protects primitives from being changed, but it doesn't protect objects. The only sound\nmeans of state change in React is the ",Object(a.b)("em",{parentName:"p"},"setState")," method and any code that asserts it is correct in doing so.\nIn the example below, the ",Object(a.b)("em",{parentName:"p"},"sumData"),' function rightfully asserts that the state object will not change\nand based on that it caches its output based on the state object\'s internal field "data".'),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),"export const Component: React.FunctionComponent = props => {\n  const [state, setState] = React.useState({ data: [0, 0] });\n\n  // Assert state immutability.\n  const data = state.data;\n  const sumData = React.useCallback(\n    () => data.reduce((acc, val) => acc + val, 0),\n    [data]\n  );\n\n  const run = () => {\n    // State mutated.\n    state.data = [1, 1];\n    // Sum is out of sync.\n    state.data.push(sumData());\n    state.data.push(sumData());\n    state.data.push(sumData());\n    setState({ data: state.data });\n  };\n")),Object(a.b)("p",null,"However, the ",Object(a.b)("em",{parentName:"p"},"run")," function changes the state object -- its internal field ",Object(a.b)("em",{parentName:"p"},"data")," now points to a\ndifferent address. ",Object(a.b)("em",{parentName:"p"},"sumData")," captures the original address (that wasn't supposed to change), and therefore\nit will sum the original data."),Object(a.b)("p",null,"The logical step in rectifying this seems to be to make ",Object(a.b)("em",{parentName:"p"},"sumData")," capture the entire state -- since it is\nreadonly we will be sure that we always refer to the correct address. It also seemingly makes sense not to construct\na new state object in ",Object(a.b)("em",{parentName:"p"},"run")," since we only change a single field inside of it:"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),"export const Component: React.FunctionComponent = props => {\n  const [state, setState] = React.useState({ data: [0, 0] });\n\n  // Assert state immutability.\n  const sumData = React.useCallback(\n    () => state.data.reduce((acc, val) => acc + val, 0),\n    [state]\n  );\n\n  const run = () => {\n    // State mutated.\n    state.data = [1, 1];\n    // Sum is in sync.\n    state.data.push(sumData());\n    state.data.push(sumData());\n    state.data.push(sumData());\n    setState(state);\n  };\n")),Object(a.b)("p",null,"The issue with this change is that now it doesn't work at all, because React asserts that since the\naddress of the state object hasn't changed, the object itself hasn't changed, and it will ignore the\nsetState call. The obvious solution is to copy the object:"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),"export const Component: React.FunctionComponent = props => {\n  const [state, setState] = React.useState({ data: [0, 0] });\n\n  // Assert state immutability.\n  const sumData = React.useCallback(\n    () => state.data.reduce((acc, val) => acc + val, 0),\n    [state]\n  );\n\n  const run = () => {\n    state.data = [1, 1];\n    // Contract violation.\n    state.data.push(sumData());\n    state.data.push(sumData());\n    state.data.push(sumData());\n    setState({...state});\n  };\n")),Object(a.b)("p",null,'Now the code will work. The issue with this code, however, is that it is breaking the immutability contract\nwith React and that it is prone to error. If the state object were to consist of multiple nested fields,\nwe would have to make sure that the object is copied properly to form a new state. Since there is no native\nconcept of "deep copy" in javascript, doing this can be rather cumbersome:'),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),'export const Component: React.FunctionComponent = props => {\n  const [state, setState] = React.useState(getCumbersomeState());\n\n  const getStateString = React.useCallback(() => JSON.stringify(state), [\n    state\n  ]);\n\n  const updateJillsStreet = () => {\n    // It is easy to get lost in this sea of spread operators and brackets.\n    setState(prevState => ({\n      people: [\n        { ...prevState.people[0] },\n        {\n          ...prevState.people[1],\n          addresses: [\n            {\n              ...prevState.people[1].addresses[0],\n              street: `Street ${Math.random()}`\n            }\n          ]\n        }\n      ]\n    }));\n  };\n\n  return (\n    <div className="App">\n      <div>{getStateString()}</div>\n      <div>\n        <button onClick={updateJillsStreet}>updateJillsStreet</button>\n      </div>\n    </div>\n  );\n};\n')),Object(a.b)("h3",null,"Immer.js to the rescue"),Object(a.b)("p",null,"And that is when Immer.js comes to the rescue. Immer.js uses ES6 proxies (note that when transcompiled to ES5\nit will become much slower) to record changes to a so called ",Object(a.b)("em",{parentName:"p"},"draft")," object during the execution of the ",Object(a.b)("em",{parentName:"p"},"produce"),"\nfunction and then project them onto a new object that becomes the new state. The ",Object(a.b)("em",{parentName:"p"},"draft")," object is based on the existing\nstate that is passed to the ",Object(a.b)("em",{parentName:"p"},"produce")," function along with the draft callback. The following snippet demonstrates\nhow we go from cumbersome, ugly, and ureadable to straightforward, beautiful, and well readable:"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),'export const Component: React.FunctionComponent = props => {\n  const [state, setState] = React.useState(getCumbersomeState());\n\n  const getStateString = React.useCallback(() => JSON.stringify(state), [\n    state\n  ]);\n\n  const updateJillsStreet = () => {\n    setState(\n      produce(state, _draft => {\n        _draft.people[1].addresses[0].street = `Street ${Math.random()}`;\n      })\n    );\n  };\n\n  return (\n    <div className="App">\n      <div>{getStateString()}</div>\n      <div>\n        <button onClick={updateJillsStreet}>updateJillsStreet</button>\n      </div>\n    </div>\n  );\n};\n')),Object(a.b)("p",null,"This can be further simplified by using the ",Object(a.b)("em",{parentName:"p"},"use-immer")," npm package that provides us with a hook\nthat combines the native ",Object(a.b)("em",{parentName:"p"},"React.useState")," and Immer's ",Object(a.b)("em",{parentName:"p"},"produce"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object.assign({parentName:"pre"},{className:"language-jsx"}),'export const Component: React.FunctionComponent = props => {\n  const [state, setState] = useImmer(getCumbersomeState());\n\n  const getStateString = React.useCallback(() => JSON.stringify(state), [\n    state\n  ]);\n\n  const updateJillsStreet = () => {\n    setState(_draft => {\n      _draft.people[1].addresses[0].street = `Street ${Math.random()}`;\n    });\n  };\n\n  return (\n    <div className="App">\n      <div>{getStateString()}</div>\n      <div>\n        <button onClick={updateJillsStreet}>updateJillsStreet</button>\n      </div>\n    </div>\n  );\n};\n')),Object(a.b)("p",null,"In the newly created state, fields that didn't change during the execution of the draft callback\nwill be referentially equal to the fields in the original state. Only fields that were changed\nin the draft and the root object will be new objects."),Object(a.b)("h3",null,"Resources"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object.assign({parentName:"li"},{href:"https://immerjs.github.io/immer/docs/introduction"}),"https://immerjs.github.io/immer/docs/introduction"))))}De.isMDXComponent=!0;var ze=function(){return r.a.createElement(u.a,null,r.a.createElement("div",{className:"wrapper"},r.a.createElement("header",null,r.a.createElement("h1",null,"React Patterns")),r.a.createElement("div",{className:"main"},r.a.createElement("aside",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(u.b,{to:"/"},"Overview")),r.a.createElement("li",null,r.a.createElement(u.b,{to:"/components"},"Components"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(u.b,{to:"/class-component"},"Class Component")),r.a.createElement("li",null,r.a.createElement(u.b,{to:"/pure-component"},"Pure Component")),r.a.createElement("li",null,r.a.createElement(u.b,{to:"/function-component"},"Function Component")))),r.a.createElement("li",null,r.a.createElement(u.b,{to:"/hooks"},"Hooks")),r.a.createElement("li",null,r.a.createElement(u.b,{to:"/context"},"Context")),r.a.createElement("li",null,r.a.createElement(u.b,{to:"/functions"},"Functions")),r.a.createElement("li",null,r.a.createElement(u.b,{to:"/immutability"},"Immutability")))),r.a.createElement("main",null,r.a.createElement(r.a.Suspense,{fallback:r.a.createElement("div",null,"Loading...")},r.a.createElement(b.c,null,r.a.createElement(b.a,{path:"/components",component:A}),r.a.createElement(b.a,{path:"/class-component",component:W}),r.a.createElement(b.a,{path:"/pure-component",component:G}),r.a.createElement(b.a,{path:"/function-component",component:ne}),r.a.createElement(b.a,{path:"/hooks",component:re}),r.a.createElement(b.a,{path:"/context",component:Te}),r.a.createElement(b.a,{path:"/functions",component:se}),r.a.createElement(b.a,{path:"/immutability",component:De}),r.a.createElement(b.a,{exact:!0,path:"/",component:O}))))),r.a.createElement("footer",null,"\xa9 2019, Sergii Mykhailov. ",r.a.createElement(u.b,{to:"/"},"React Patterns"))))},Ie=n(22),Je=(n(41),{code:function(e){var t=e.className,n=void 0===t?"language-jsx":t,a=e.children,o=void 0===a?"":a,c=n.replace("language-",""),l=o.replace(/\n$/,"");return r.a.createElement(r.a.Fragment,null,r.a.createElement("style",null,".prism-code .token.plain { display: inline-block; }"),r.a.createElement("style",null,".prism-code .token.comment { font-style: normal; }"),r.a.createElement(Ie.a,Object.assign({},Ie.b,{code:l,language:c,theme:void 0}),(function(e){var t=e.className,n=e.style,a=e.tokens,o=e.getLineProps,c=e.getTokenProps;return r.a.createElement("pre",{className:t,style:Object(x.a)({},n,{padding:3})},a.map((function(e,t){return r.a.createElement("div",o({line:e,key:t}),e.map((function(e,t){return r.a.createElement("span",c({token:e,key:t}))})))})))})))}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(42);new i.a(m.a).injectStyles(),l.a.render(r.a.createElement(a.a,{components:Je},r.a.createElement(ze,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[31,1,2]]]);
//# sourceMappingURL=main.f5e99690.chunk.js.map